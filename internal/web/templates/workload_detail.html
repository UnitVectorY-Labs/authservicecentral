{{define "title"}}{{.Workload.Name}} — authservicecentral{{end}}
{{define "content"}}
<div class="space-y-6">
  <!-- Header -->
  <div class="sm:flex sm:items-center sm:justify-between">
    <div class="flex items-center space-x-3">
      <h1 class="text-2xl font-bold text-gray-900">{{.Workload.Name}}</h1>
    </div>
    <a href="/admin/providers/{{.Provider.ID}}" class="mt-4 sm:mt-0 text-sm text-gray-500 hover:text-gray-700">&larr; Back to {{.Provider.Name}}</a>
  </div>

  {{if .Error}}<div class="rounded-md bg-red-50 p-4 text-sm text-red-800">{{.Error}}</div>{{end}}

  <!-- Workload Details -->
  <div class="overflow-hidden rounded-lg bg-white shadow-sm ring-1 ring-gray-200">
    <form method="POST" action="/admin/providers/{{.Provider.ID}}/workloads/{{.Workload.ID}}" class="divide-y divide-gray-200">
      <div class="px-6 py-5 space-y-4">
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
          <input type="text" id="name" name="name" value="{{.Workload.Name}}" required maxlength="255"
                 class="mt-1 block w-full max-w-lg rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
        </div>
        <div>
          <label for="selector" class="block text-sm font-medium text-gray-700">Selector (JSON)</label>
          <textarea id="selector" name="selector" rows="6" required
                    class="mt-1 block w-full max-w-lg rounded-md border border-gray-300 px-3 py-2 text-sm font-mono shadow-sm focus:border-indigo-500 focus:ring-indigo-500">{{.SelectorStr}}</textarea>
        </div>
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 text-sm text-gray-500">
          <div>Created: {{.Workload.CreatedAt.Format "2006-01-02 15:04:05 UTC"}}</div>
          <div>Updated: {{.Workload.UpdatedAt.Format "2006-01-02 15:04:05 UTC"}}</div>
        </div>
      </div>
      <div class="px-6 py-4 bg-gray-50">
        <button type="submit" class="rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-500">Save Changes</button>
      </div>
    </form>
  </div>

  <!-- Linked Applications -->
  <div class="space-y-4">
    <h2 class="text-lg font-semibold text-gray-900">Linked Applications</h2>

    <form method="POST" action="/admin/providers/{{.Provider.ID}}/workloads/{{.Workload.ID}}/link" class="flex items-end space-x-3">
      <div>
        <label for="application_id" class="block text-sm font-medium text-gray-700">Link Application</label>
        <select id="application_id" name="application_id" required
                class="mt-1 block w-64 rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
          <option value="">Select an application…</option>
          {{range .AllApps}}
          <option value="{{.ID}}">{{.Subject}}{{if .Description.Valid}} — {{.Description.String}}{{end}}</option>
          {{end}}
        </select>
      </div>
      <button type="submit" class="rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-500">Link</button>
    </form>

    <div class="overflow-hidden rounded-lg bg-white shadow-sm ring-1 ring-gray-200">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">Application</th>
            <th scope="col" class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 bg-white">
          {{if .Apps}}
          {{range .Apps}}
          <tr>
            <td class="whitespace-nowrap px-6 py-4 text-sm">
              <a href="/admin/apps/{{.Subject}}" class="font-medium text-indigo-600 hover:text-indigo-500">{{.Subject}}</a>
              {{if .Description.Valid}}<span class="ml-2 text-gray-500">{{.Description.String}}</span>{{end}}
            </td>
            <td class="whitespace-nowrap px-6 py-4 text-right text-sm">
              <form method="POST" action="/admin/providers/{{$.Provider.ID}}/workloads/{{$.Workload.ID}}/unlink" class="inline">
                <input type="hidden" name="application_id" value="{{.ApplicationID}}">
                <button type="submit" class="text-red-600 hover:text-red-500">Unlink</button>
              </form>
            </td>
          </tr>
          {{end}}
          {{else}}
          <tr>
            <td colspan="2" class="px-6 py-12 text-center text-sm text-gray-500">No applications linked to this workload.</td>
          </tr>
          {{end}}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Delete Workload -->
  <div class="rounded-lg bg-white shadow-sm ring-1 ring-gray-200 p-6">
    <h2 class="text-lg font-semibold text-red-600">Delete Workload</h2>
    <p class="mt-1 text-sm text-gray-500">This action cannot be undone. All application links will be removed.</p>
    <form method="POST" action="/admin/providers/{{.Provider.ID}}/workloads/{{.Workload.ID}}/delete" class="mt-4"
          onsubmit="return confirm('Are you sure you want to delete this workload?');">
      <button type="submit" class="rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-red-500">Delete Workload</button>
    </form>
  </div>
</div>
{{end}}
